<!DOCTYPE html>
<html>
<head>
    <title>Test Simulator Frontend</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Test Simulator Frontend</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        
        async function testWatchlist() {
            output.innerHTML += '<h2>Testing Watchlist API</h2>';
            
            try {
                const response = await axios.get('http://localhost:8000/api/user/watchlist');
                output.innerHTML += `<p>✓ Watchlist loaded: ${response.data.length} stocks</p>`;
                output.innerHTML += '<pre>' + JSON.stringify(response.data.slice(0, 3), null, 2) + '</pre>';
                
                if (response.data.length > 0) {
                    testSimulator(response.data[0].symbol);
                }
            } catch (error) {
                output.innerHTML += `<p>✗ Error: ${error.message}</p>`;
                console.error(error);
            }
        }
        
        async function testSimulator(symbol) {
            output.innerHTML += '<h2>Testing Simulator API</h2>';
            
            const today = new Date();
            const oneYearAgo = new Date(today);
            oneYearAgo.setFullYear(today.getFullYear() - 1);
            
            const data = {
                symbol: symbol,
                amount: 10000,
                start_date: oneYearAgo.toISOString().split('T')[0],
                end_date: today.toISOString().split('T')[0]
            };
            
            output.innerHTML += '<p>Request data:</p>';
            output.innerHTML += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            
            try {
                const response = await axios.post('http://localhost:8000/api/simulator/simulate', data);
                output.innerHTML += '<p>✓ Simulation completed</p>';
                output.innerHTML += '<pre>' + JSON.stringify(response.data, null, 2) + '</pre>';
            } catch (error) {
                output.innerHTML += `<p>✗ Error: ${error.message}</p>`;
                if (error.response) {
                    output.innerHTML += '<pre>' + JSON.stringify(error.response.data, null, 2) + '</pre>';
                }
                console.error(error);
            }
        }
        
        testWatchlist();
    </script>
</body>
</html>
